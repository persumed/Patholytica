<!DOCTYPE html>

<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
<title>Patholytica â€” Academic Libraries</title>

<!-- Font Awesome for icons -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

<style>
:root {
  --bg-color: #0f0f0f;
  --text-primary: #fff;
  --text-secondary: #aaa;
  --card-bg: #1f1f1f;
  --hover-bg: #2a2a2a;
  --border-color: #303030;
  --accent: #3ea6ff;
  --accent-hover: #2d8ed6;
}

body.light-theme {
  --bg-color: #ffffff;
  --text-primary: #0f0f0f;
  --text-secondary: #606060;
  --card-bg: #f9f9f9;
  --hover-bg: #f0f0f0;
  --border-color: #e5e5e5;
  --accent: #065fd4;
  --accent-hover: #0448a3;
}

* { box-sizing: border-box; }
html, body { margin:0; padding:0; min-height:100%; font-family: "Roboto", Arial, sans-serif; }

body {
  background: var(--bg-color);
  color: var(--text-primary);
  transition: background 0.2s ease, color 0.2s ease;
}

.header-wrapper {
  position: sticky;
  top: 0;
  background: var(--bg-color);
  padding-top: env(safe-area-inset-top);
  border-bottom: 1px solid var(--border-color);
  z-index: 40;
}

.header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 12px 24px;
  max-width: 1400px;
  margin: 0 auto;
}

.logo-img {
  height: 28px;
  width: auto;
  transition: filter 0.2s ease;
  cursor: pointer;
}

body.light-theme .logo-img {
  filter: invert(1);
}

.header-actions {
  display: flex;
  align-items: center;
  gap: 16px;
}

.icon-btn {
  width: 40px;
  height: 40px;
  border-radius: 50%;
  background: transparent;
  border: none;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 18px;
  transition: background 0.2s ease;
}

.icon-btn:hover {
  background: var(--hover-bg);
}

.user-menu {
  position: relative;
}

.user-avatar {
  width: 32px;
  height: 32px;
  border-radius: 50%;
  background: linear-gradient(135deg, #667eea, #764ba2);
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 14px;
  font-weight: 500;
  color: white;
  cursor: pointer;
  transition: transform 0.2s ease;
}

.user-avatar:hover {
  transform: scale(1.05);
}

.login-icon-btn {
  width: 40px;
  height: 40px;
  border-radius: 50%;
  background: var(--accent);
  border: none;
  color: white;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 18px;
  transition: all 0.2s ease;
}

.login-icon-btn:hover {
  background: var(--accent-hover);
  transform: scale(1.05);
}

.dropdown-menu {
  position: absolute;
  top: calc(100% + 8px);
  right: 0;
  background: var(--card-bg);
  border: 1px solid var(--border-color);
  border-radius: 8px;
  min-width: 200px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.3);
  display: none;
  z-index: 100;
}

.dropdown-menu.show {
  display: block;
}

.dropdown-item {
  padding: 12px 16px;
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 10px;
  color: var(--text-primary);
  text-decoration: none;
  transition: background 0.2s ease;
  border: none;
  background: transparent;
  width: 100%;
  text-align: left;
  font-size: 14px;
}

.dropdown-item:hover {
  background: var(--hover-bg);
}

.dropdown-divider {
  height: 1px;
  background: var(--border-color);
  margin: 4px 0;
}

.user-info {
  padding: 12px 16px;
  border-bottom: 1px solid var(--border-color);
}

.user-name {
  font-weight: 600;
  font-size: 14px;
  margin-bottom: 2px;
}

.user-email {
  font-size: 12px;
  color: var(--text-secondary);
}

.main-container {
  max-width: 1400px;
  margin: 0 auto;
  padding: 32px 24px 60px;
}

.hero-section {
  margin-bottom: 48px;
}

.hero-section h1 {
  font-size: 32px;
  margin: 0 0 8px 0;
  font-weight: 500;
}

.hero-section p {
  font-size: 15px;
  color: var(--text-secondary);
  margin: 0 0 24px 0;
  line-height: 1.6;
}

.search-bar {
  max-width: 600px;
  position: relative;
}

.search-input {
  width: 100%;
  padding: 10px 16px;
  border-radius: 24px;
  border: 1px solid var(--border-color);
  background: var(--card-bg);
  color: var(--text-primary);
  font-size: 14px;
  transition: border-color 0.2s ease;
}

.search-input:focus {
  border-color: var(--accent);
  outline: none;
}

.search-input::placeholder {
  color: var(--text-secondary);
}

.section-header {
  margin-bottom: 20px;
}

.section-title {
  font-size: 20px;
  font-weight: 500;
  margin: 0;
  display: flex;
  align-items: center;
  gap: 8px;
}

.section-icon {
  font-size: 20px;
}

.library-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
  gap: 16px;
  margin-bottom: 48px;
}

.library-card {
  background: transparent;
  border-radius: 12px;
  overflow: hidden;
  cursor: pointer;
  transition: transform 0.2s ease;
  text-decoration: none;
  color: var(--text-primary);
  display: block;
}

.library-card:hover {
  transform: scale(1.02);
}

.library-card:hover .library-thumbnail {
  transform: scale(1.05);
}

.library-thumbnail-wrapper {
  width: 100%;
  height: 180px;
  overflow: hidden;
  border-radius: 12px;
  background: var(--card-bg);
  position: relative;
}

.library-thumbnail {
  width: 100%;
  height: 100%;
  object-fit: cover;
  transition: transform 0.3s ease;
}

.library-duration {
  position: absolute;
  bottom: 8px;
  right: 8px;
  background: rgba(0, 0, 0, 0.8);
  color: white;
  padding: 2px 6px;
  border-radius: 4px;
  font-size: 12px;
  font-weight: 500;
}

.library-content {
  padding: 12px 0;
}

.library-header {
  display: flex;
  gap: 12px;
  align-items: flex-start;
}

.author-avatar {
  width: 36px;
  height: 36px;
  border-radius: 50%;
  background: linear-gradient(135deg, #667eea, #764ba2);
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 14px;
  font-weight: 500;
  color: white;
  flex-shrink: 0;
}

.library-info {
  flex: 1;
  min-width: 0;
}

.library-title {
  font-size: 15px;
  font-weight: 500;
  margin: 0 0 4px 0;
  line-height: 1.4;
  display: -webkit-box;
  -webkit-line-clamp: 2;
  -webkit-box-orient: vertical;
  overflow: hidden;
}

.library-meta {
  display: flex;
  align-items: center;
  gap: 8px;
  font-size: 13px;
  color: var(--text-secondary);
  flex-wrap: wrap;
}

.meta-item {
  display: flex;
  align-items: center;
  gap: 4px;
}

.meta-separator {
  width: 3px;
  height: 3px;
  border-radius: 50%;
  background: var(--text-secondary);
}

.empty-state {
  text-align: center;
  padding: 60px 20px;
  color: var(--text-secondary);
}

.empty-state i {
  font-size: 48px;
  margin-bottom: 16px;
  opacity: 0.5;
}

.loading-overlay {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: var(--bg-color);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 1000;
}

.loading-spinner {
  width: 50px;
  height: 50px;
  border: 4px solid var(--border-color);
  border-top-color: var(--accent);
  border-radius: 50%;
  animation: spin 0.8s linear infinite;
}

@keyframes spin {
  to { transform: rotate(360deg); }
}

#notificationArea {
  position: fixed;
  top: calc(70px + env(safe-area-inset-top));
  right: 20px;
  z-index: 100;
  max-width: 400px;
}

.notification {
  background: var(--card-bg);
  backdrop-filter: blur(20px);
  border: 1px solid var(--border-color);
  border-radius: 10px;
  padding: 14px 18px;
  margin-bottom: 12px;
  box-shadow: 0 8px 24px rgba(0,0,0,0.3);
  display: flex;
  align-items: center;
  gap: 12px;
  transform: translateX(450px);
  transition: transform 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
  font-size: 14px;
}

.notification.show {
  transform: translateX(0);
}

.notification-dot {
  width: 8px;
  height: 8px;
  border-radius: 50%;
  flex-shrink: 0;
}

.notification.success .notification-dot {
  background: #10b981;
}

.notification.error .notification-dot {
  background: #ef4444;
}

.notification.info .notification-dot {
  background: #3b82f6;
}

.notification-message {
  flex: 1;
  line-height: 1.4;
}

@media (max-width: 768px) {
  .hero-section h1 { font-size: 26px; }
  .library-grid {
    grid-template-columns: 1fr;
  }
  .header {
    padding: 12px 16px;
  }
  .main-container {
    padding: 24px 16px 48px;
  }
  #notificationArea {
    left: 16px;
    right: 16px;
    max-width: none;
  }
}
</style>

</head>
<body>

<!-- Loading Overlay -->

<div class="loading-overlay" id="loadingOverlay">
  <div class="loading-spinner"></div>
</div>

<!-- Notification Area -->

<div id="notificationArea"></div>

<div class="header-wrapper">
  <div class="header">
    <a href="https://patholytica.com">
      <img src="IMG_0696.png" class="logo-img" alt="Patholytica Logo">
    </a>
    <div class="header-actions">
      <button class="icon-btn" onclick="openSearch()" title="Search">
        <i class="fas fa-search"></i>
      </button>
      <button class="icon-btn" onclick="toggleTheme()" title="Toggle theme">
        <i class="fas fa-circle-half-stroke"></i>
      </button>

  <!-- User menu - shown when logged in -->
  <div class="user-menu" id="userMenuContainer" style="display: none;">
    <div class="user-avatar" id="userAvatar" onclick="toggleUserMenu()">U</div>
    <div class="dropdown-menu" id="userDropdown">
      <div class="user-info">
        <div class="user-name" id="userName">Loading...</div>
        <div class="user-email" id="userEmail">Loading...</div>
      </div>
      <a href="dashboard.html" class="dropdown-item">
        <i class="fas fa-home"></i>
        <span>Dashboard</span>
      </a>
      <a href="#" class="dropdown-item">
        <i class="fas fa-cog"></i>
        <span>Settings</span>
      </a>
      <div class="dropdown-divider"></div>
      <button class="dropdown-item" onclick="handleLogout()">
        <i class="fas fa-sign-out-alt"></i>
        <span>Sign Out</span>
      </button>
    </div>
  </div>
  
  <!-- Login button - shown when not logged in -->
  <button class="login-icon-btn" id="loginButton" style="display: none;" onclick="goToLogin()" title="Login">
    <i class="fas fa-arrow-right-to-bracket"></i>
  </button>
</div>

  </div>
</div>

<div class="main-container">
  <!-- Hero Section -->
  <div class="hero-section">
    <h1>Academic Libraries</h1>
    <p>Explore curated collections of research data, case studies, and academic resources.</p>
    <div class="search-bar">
      <input type="text" class="search-input" placeholder="Search libraries..." id="searchInput">
    </div>
  </div>

  <!-- Latest Libraries Section -->

  <div class="section-header">
    <h2 class="section-title">
      <i class="fas fa-clock section-icon"></i>
      Latest Libraries
    </h2>
  </div>
  <div class="library-grid" id="latestLibraries"></div>

  <!-- Most Popular Section -->

  <div class="section-header">
    <h2 class="section-title">
      <i class="fas fa-fire section-icon"></i>
      Most Popular
    </h2>
  </div>
  <div class="library-grid" id="popularLibraries"></div>
</div>

<script type="module">
import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js';
import { 
  getAuth, 
  onAuthStateChanged,
  signOut
} from 'https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js';

// Hide loading overlay after timeout as fallback
setTimeout(() => {
  const loadingOverlay = document.getElementById('loadingOverlay');
  if (loadingOverlay && loadingOverlay.style.display !== 'none') {
    loadingOverlay.style.display = 'none';
    console.log("Loading overlay hidden by timeout");
  }
}, 3000);

const firebaseConfig = {
  apiKey: "AIzaSyBs6V0yY14cuLBXB1nciZ-X0eyAiodC-Ak",
  authDomain: "patholytica.firebaseapp.com",
  projectId: "patholytica",
  storageBucket: "patholytica.firebasestorage.app",
  messagingSenderId: "738430635282",
  appId: "1:738430635282:web:8451ef380447c7611137cb"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);

// NOTIFICATION SYSTEM
function showNotification(message, type = 'info') {
  const notificationArea = document.getElementById('notificationArea');
  const notification = document.createElement('div');
  notification.className = `notification ${type}`;
  
  notification.innerHTML = `
    <div class="notification-dot"></div>
    <span class="notification-message">${message}</span>
  `;
  
  notificationArea.appendChild(notification);
  
  setTimeout(() => {
    notification.classList.add('show');
  }, 10);
  
  setTimeout(() => {
    notification.classList.remove('show');
    setTimeout(() => {
      if (notification.parentNode) {
        notification.parentNode.removeChild(notification);
      }
    }, 400);
  }, 5000);
}

window.showNotification = showNotification;

// Check authentication status
onAuthStateChanged(auth, (user) => {
  const loadingOverlay = document.getElementById('loadingOverlay');
  const userMenuContainer = document.getElementById('userMenuContainer');
  const loginButton = document.getElementById('loginButton');
  
  if (user) {
    // User is signed in
    console.log("User authenticated:", user.email);
    
    // Show user menu, hide login button
    userMenuContainer.style.display = 'block';
    loginButton.style.display = 'none';
    
    // Get user display name or email
    const displayName = user.displayName || user.email.split('@')[0];
    const email = user.email;
    
    // Set user avatar initials
    const userAvatar = document.getElementById('userAvatar');
    const initials = displayName.substring(0, 2).toUpperCase();
    userAvatar.textContent = initials;
    
    // Set user info in dropdown
    document.getElementById('userName').textContent = displayName;
    document.getElementById('userEmail').textContent = email;
    
  } else {
    // No user signed in - show login button
    console.log("No user authenticated - showing login button");
    
    // Hide user menu, show login button
    userMenuContainer.style.display = 'none';
    loginButton.style.display = 'flex';
  }
  
  // Hide loading and show content regardless of auth status
  if (loadingOverlay) {
    loadingOverlay.style.display = 'none';
  }
  
  // Initialize page content
  renderLibraries();
  
}, (error) => {
  // Handle auth error
  console.error("Auth error:", error);
  const loadingOverlay = document.getElementById('loadingOverlay');
  if (loadingOverlay) {
    loadingOverlay.style.display = 'none';
  }
  // Show login button on error
  document.getElementById('loginButton').style.display = 'flex';
  document.getElementById('userMenuContainer').style.display = 'none';
  // Still render libraries even on auth error
  renderLibraries();
});

// Go to login page
window.goToLogin = function() {
  window.location.href = "index.html";
};

// Logout handler
window.handleLogout = function() {
  signOut(auth)
    .then(() => {
      showNotification("Signed out successfully", "success");
      setTimeout(() => {
        window.location.href = "index.html";
      }, 1000);
    })
    .catch((error) => {
      console.error("Logout error:", error);
      showNotification("Error signing out: " + error.message, "error");
    });
};

// Theme toggle
window.toggleTheme = function(){
  document.body.classList.toggle('light-theme');
  localStorage.setItem(
    "theme",
    document.body.classList.contains("light-theme") ? "light" : "dark"
  );
};

if (localStorage.getItem("theme") === "light") {
  document.body.classList.add("light-theme");
}

// User menu toggle
window.toggleUserMenu = function() {
  const dropdown = document.getElementById('userDropdown');
  dropdown.classList.toggle('show');
};

// Close dropdown when clicking outside
document.addEventListener('click', (e) => {
  const userMenu = document.querySelector('.user-menu');
  const dropdown = document.getElementById('userDropdown');
  
  if (userMenu && !userMenu.contains(e.target) && dropdown.classList.contains('show')) {
    dropdown.classList.remove('show');
  }
});

window.openSearch = function() {
  document.getElementById('searchInput').focus();
};

// Sample library data
const libraries = {
  latest: [
    {
      id: 1,
      title: "Cardiovascular Pathology Database",
      author: "Dr. Sarah Mitchell",
      authorInitials: "SM",
      date: "2 days ago",
      datasets: 248,
      views: 1203,
      thumbnail: "https://images.unsplash.com/photo-1576091160550-2173dba999ef?w=800&h=600&fit=crop"
    },
    {
      id: 2,
      title: "Neurological Disorders Repository",
      author: "Dr. James Chen",
      authorInitials: "JC",
      date: "5 days ago",
      datasets: 312,
      views: 892,
      thumbnail: "https://images.unsplash.com/photo-1559757175-5700dde675bc?w=800&h=600&fit=crop"
    },
    {
      id: 3,
      title: "Oncology Research Collection",
      author: "Dr. Emily Rodriguez",
      authorInitials: "ER",
      date: "1 week ago",
      datasets: 437,
      views: 1567,
      thumbnail: "https://images.unsplash.com/photo-1532187863486-abf9dbad1b69?w=800&h=600&fit=crop"
    },
    {
      id: 4,
      title: "Infectious Disease Archive",
      author: "Dr. Michael Park",
      authorInitials: "MP",
      date: "1 week ago",
      datasets: 195,
      views: 743,
      thumbnail: "https://images.unsplash.com/photo-1584036561566-baf8f5f1b144?w=800&h=600&fit=crop"
    }
  ],
  popular: [
    {
      id: 5,
      title: "Clinical Pathology Atlas",
      author: "Dr. Lisa Anderson",
      authorInitials: "LA",
      date: "3 months ago",
      datasets: 892,
      views: 15234,
      thumbnail: "https://images.unsplash.com/photo-1581093458791-9d42e1b7f1f9?w=800&h=600&fit=crop"
    },
    {
      id: 6,
      title: "Pediatric Disease Database",
      author: "Dr. Robert Kim",
      authorInitials: "RK",
      date: "2 months ago",
      datasets: 524,
      views: 12891,
      thumbnail: "https://images.unsplash.com/photo-1631217868264-e5b90bb7e133?w=800&h=600&fit=crop"
    },
    {
      id: 7,
      title: "Gastrointestinal Pathology Hub",
      author: "Dr. Maria Santos",
      authorInitials: "MS",
      date: "4 months ago",
      datasets: 651,
      views: 11456,
      thumbnail: "https://images.unsplash.com/photo-1579154204601-01588f351e67?w=800&h=600&fit=crop"
    },
    {
      id: 8,
      title: "Dermatopathology Library",
      author: "Dr. David Thompson",
      authorInitials: "DT",
      date: "5 months ago",
      datasets: 389,
      views: 9823,
      thumbnail: "https://images.unsplash.com/photo-1612349317150-e413f6a5b16d?w=800&h=600&fit=crop"
    }
  ]
};

function createLibraryCard(library) {
  return `
    <a href="library.html?id=${library.id}" class="library-card">
      <div class="library-thumbnail-wrapper">
        <img src="${library.thumbnail}" alt="${library.title}" class="library-thumbnail" />
        <div class="library-duration">${library.datasets} datasets</div>
      </div>
      
      <div class="library-content">
        <div class="library-header">
          <div class="author-avatar">${library.authorInitials}</div>
          <div class="library-info">
            <h3 class="library-title">${library.title}</h3>
            <div class="library-meta">
              <span class="meta-item">${library.author}</span>
              <span class="meta-separator"></span>
              <span class="meta-item">${library.views.toLocaleString()} views</span>
              <span class="meta-separator"></span>
              <span class="meta-item">${library.date}</span>
            </div>
          </div>
        </div>
      </div>
    </a>
  `;
}

function renderLibraries() {
  const latestContainer = document.getElementById('latestLibraries');
  const popularContainer = document.getElementById('popularLibraries');
  
  if (latestContainer && popularContainer) {
    latestContainer.innerHTML = libraries.latest.map(lib => createLibraryCard(lib)).join('');
    popularContainer.innerHTML = libraries.popular.map(lib => createLibraryCard(lib)).join('');
  }
}

// Search functionality
const searchInput = document.getElementById('searchInput');
if (searchInput) {
  searchInput.addEventListener('input', (e) => {
    const searchTerm = e.target.value.toLowerCase();
    
    if (searchTerm === '') {
      renderLibraries();
      return;
    }
    
    const allLibraries = [...libraries.latest, ...libraries.popular];
    const filtered = allLibraries.filter(lib => 
      lib.title.toLowerCase().includes(searchTerm) ||
      lib.author.toLowerCase().includes(searchTerm)
    );
    
    const latestContainer = document.getElementById('latestLibraries');
    const popularContainer = document.getElementById('popularLibraries');
    
    if (filtered.length === 0) {
      latestContainer.innerHTML = `
        <div class="empty-state" style="grid-column: 1/-1;">
          <i class="fas fa-search"></i>
          <p>No libraries found matching "${searchTerm}"</p>
        </div>
      `;
      popularContainer.innerHTML = '';
    } else {
      latestContainer.innerHTML = filtered.map(lib => createLibraryCard(lib)).join('');
      popularContainer.innerHTML = '';
    }
  });
}
</script>

</body>
</html>