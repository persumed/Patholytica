<!DOCTYPE html>

<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
<title>Patholytica — Academic Libraries</title>

<!-- Font Awesome for icons -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

<style>
:root {
  --bg-color: #0f0f0f;
  --text-primary: #fff;
  --text-secondary: #aaa;
  --card-bg: #1f1f1f;
  --hover-bg: #2a2a2a;
  --border-color: #303030;
  --accent: #3ea6ff;
  --accent-hover: #2d8ed6;
  --success: #10b981;
  --error: #ef4444;
  --warning: #f59e0b;
  --info: #3b82f6;
}

body.light-theme {
  --bg-color: #ffffff;
  --text-primary: #0f0f0f;
  --text-secondary: #606060;
  --card-bg: #f9f9f9;
  --hover-bg: #f0f0f0;
  --border-color: #e5e5e5;
  --accent: #065fd4;
  --accent-hover: #0448a3;
}

* { box-sizing: border-box; }
html, body { margin:0; padding:0; min-height:100%; font-family: "Roboto", Arial, sans-serif; }

body {
  background: var(--bg-color);
  color: var(--text-primary);
  transition: background 0.2s ease, color 0.2s ease;
  display: flex;
  flex-direction: column;
}

.header-wrapper {
  position: sticky;
  top: 0;
  background: var(--bg-color);
  padding-top: env(safe-area-inset-top);
  border-bottom: 1px solid var(--border-color);
  z-index: 40;
}

.header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 12px 24px;
  max-width: 1400px;
  margin: 0 auto;
}

.logo-img {
  height: 28px;
  width: auto;
  transition: filter 0.2s ease;
  cursor: pointer;
}

body.light-theme .logo-img {
  filter: invert(1);
}

.icon-btn {
  width: 40px;
  height: 40px;
  border-radius: 50%;
  background: transparent;
  border: none;
  color: var(--text-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 18px;
  transition: background 0.2s ease;
}

.icon-btn:hover {
  background: var(--hover-bg);
}

.login-container {
  flex: 1;
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 40px 20px;
  padding-bottom: calc(40px + env(safe-area-inset-bottom));
}

.login-card {
  width: 100%;
  max-width: 430px;
  padding: 48px 40px;
  background: var(--card-bg);
  border-radius: 12px;
  border: 1px solid var(--border-color);
  box-shadow: 0 4px 12px rgba(0,0,0,0.3);
  text-align: center;
  animation: fadeUp 0.5s ease both;
}

.login-card h1 {
  font-size: 32px;
  margin: 0 0 8px 0;
  font-weight: 500;
}

.login-card p {
  font-size: 15px;
  margin: 0 0 32px 0;
  color: var(--text-secondary);
  line-height: 1.6;
}

.login-btn {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: 10px;
  padding: 12px 24px;
  font-size: 14px;
  font-weight: 500;
  background: var(--accent);
  color: #fff;
  border-radius: 8px;
  text-decoration: none;
  transition: 0.2s ease;
  cursor: pointer;
  border: none;
  margin-bottom: 12px;
  width: 100%;
}

.login-btn:hover:not(:disabled) {
  background: var(--accent-hover);
}

.login-btn:disabled {
  opacity: 0.6;
  cursor: not-allowed;
}

.google-btn {
  background: #4285F4;
}

.google-btn:hover:not(:disabled) {
  background: #357ae8;
}

.btn-icon {
  font-size: 18px;
}

.spinner {
  display: none;
  width: 16px;
  height: 16px;
  border: 2px solid rgba(255, 255, 255, 0.3);
  border-radius: 50%;
  border-top-color: white;
  animation: spin 0.8s linear infinite;
}

.spinner.show {
  display: inline-block;
}

@keyframes spin {
  to { transform: rotate(360deg); }
}

.divider {
  display: flex;
  align-items: center;
  margin: 16px 0;
  color: var(--text-secondary);
  font-size: 13px;
}

.divider::before,
.divider::after {
  content: '';
  flex: 1;
  height: 1px;
  background: var(--border-color);
}

.divider::before { margin-right: 12px; }
.divider::after { margin-left: 12px; }

.guest-text {
  display: inline-flex;
  align-items: center;
  gap: 8px;
  font-size: 14px;
  color: var(--accent);
  margin-top: 6px;
  cursor: pointer;
  font-weight: 500;
  text-decoration: none;
}

.guest-text:hover {
  text-decoration: underline;
}

.input-field {
  width: 100%;
  padding: 10px 16px;
  margin-bottom: 12px;
  border-radius: 8px;
  border: 1px solid var(--border-color);
  background: var(--card-bg);
  color: var(--text-primary);
  font-size: 14px;
  transition: 0.2s ease;
}

.input-field:focus {
  border-color: var(--accent);
  outline: none;
}

.input-field::placeholder {
  color: var(--text-secondary);
}

#loginForm, #signupForm {
  transition: opacity 0.25s ease;
}

.form-link {
  color: var(--accent);
  text-decoration: none;
  font-weight: 500;
}

.form-link:hover {
  text-decoration: underline;
}

.form-text {
  margin-top: 16px;
  font-size: 14px;
  color: var(--text-secondary);
}

.back-link {
  margin-top: 12px;
  font-size: 14px;
  color: var(--text-secondary);
}

.terms-label {
  display: flex;
  align-items: center;
  justify-content: center;
  margin: 16px 0;
  font-size: 13px;
  color: var(--text-secondary);
  text-align: left;
}

.terms-label input {
  margin-right: 8px;
  cursor: pointer;
}

#notificationArea {
  position: fixed;
  top: calc(70px + env(safe-area-inset-top));
  right: 20px;
  z-index: 100;
  max-width: 400px;
}

.notification {
  background: var(--card-bg);
  backdrop-filter: blur(20px);
  border: 1px solid var(--border-color);
  border-radius: 10px;
  padding: 14px 18px;
  margin-bottom: 12px;
  box-shadow: 0 8px 24px rgba(0,0,0,0.3);
  display: flex;
  align-items: center;
  gap: 12px;
  transform: translateX(450px);
  transition: transform 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
  font-size: 14px;
}

.notification.show {
  transform: translateX(0);
}

.notification-dot {
  width: 8px;
  height: 8px;
  border-radius: 50%;
  flex-shrink: 0;
}

.notification.success .notification-dot {
  background: var(--success);
}

.notification.error .notification-dot {
  background: var(--error);
}

.notification.warning .notification-dot {
  background: var(--warning);
}

.notification.info .notification-dot {
  background: var(--info);
}

.notification-message {
  flex: 1;
  line-height: 1.4;
}

footer {
  text-align: center;
  padding: 16px;
  font-size: 12px;
  border-top: 1px solid var(--border-color);
  color: var(--text-secondary);
}

footer a {
  color: var(--text-secondary);
  margin: 0 6px;
  text-decoration: none;
  transition: color 0.2s ease;
}

footer a:hover { 
  color: var(--accent); 
}

@keyframes fadeUp {
  from { opacity: 0; transform: translateY(20px); }
  to   { opacity: 1; transform: translateY(0); }
}

@media (max-width: 768px) {
  .header {
    padding: 12px 16px;
  }
  .login-card { 
    padding: 40px 28px; 
  }
  .login-card h1 { 
    font-size: 28px; 
  }
  #notificationArea {
    left: 16px;
    right: 16px;
    max-width: none;
  }
}
</style>

</head>
<body>

<!-- Notification Area -->

<div id="notificationArea"></div>

<div class="header-wrapper">
  <div class="header">
    <a href="https://patholytica.com">
      <img src="IMG_0696.png" class="logo-img" alt="Patholytica Logo">
    </a>
    <button class="icon-btn" onclick="toggleTheme()" title="Toggle theme">
      <i class="fas fa-circle-half-stroke"></i>
    </button>
  </div>
</div>

<div class="login-container">
  <div class="login-card">

<h1>Welcome to Patholytica</h1>
<p>Your tool to <strong>LOVE</strong> what you learn</p>

<!-- Initial buttons -->
<div id="initialButtons">
  <button id="googleLoginBtn" class="login-btn google-btn">
    <i class="fab fa-google btn-icon"></i>
    <span>Continue with Google</span>
    <div class="spinner" id="googleSpinner"></div>
  </button>

  <div class="divider">OR</div>

  <button class="login-btn" id="startLoginBtn">
    <i class="fas fa-envelope btn-icon"></i>
    <span>Continue with Email</span>
  </button>

  <span class="guest-text" id="guestBtn">
    <i class="fas fa-user-secret"></i>
    <span>Continue as Guest</span>
  </span>
</div>

<!-- Login form -->
<form id="loginForm" style="display:none; margin-top:20px; animation: fadeUp 0.5s ease both;">
  <input type="email" placeholder="Email Address" class="input-field" id="loginEmail" required>
  <input type="password" placeholder="Password" class="input-field" id="loginPassword" required>

  <button type="submit" class="login-btn" id="loginSubmitBtn" style="margin-top:12px;">
    <span>Continue</span>
    <div class="spinner" id="loginSpinner"></div>
  </button>

  <p class="form-text">
    Don't have an account? 
    <a href="#" id="showSignupLink" class="form-link">Sign up</a>
  </p>

  <p class="back-link">
    <a href="#" id="backToInitial" class="form-link">← Back</a>
  </p>
</form>

<!-- Signup form -->
<form id="signupForm" style="display:none; margin-top:20px; animation: fadeUp 0.5s ease both;">
  <input type="text" placeholder="Full Name" class="input-field" id="signupName" required>
  <input type="email" placeholder="Email Address" class="input-field" id="signupEmail" required>
  <input type="text" placeholder="Username" class="input-field" id="signupUsername" required>
  <input type="password" placeholder="Password (min. 8 characters)" class="input-field" id="signupPassword" minlength="8" required>
  <input type="password" placeholder="Confirm Password" class="input-field" id="signupConfirm" required>

  <label class="terms-label">
    <input type="checkbox" id="termsCheckbox" required>
    <span>I agree to the <a href="#" class="form-link">Terms</a> and <a href="#" class="form-link">Privacy Policy</a></span>
  </label>

  <button type="submit" class="login-btn" id="signupSubmitBtn" style="margin-top:12px;">
    <span>Create Account</span>
    <div class="spinner" id="signupSpinner"></div>
  </button>

  <p class="form-text">
    Already have an account?
    <a href="#" id="showLoginLink" class="form-link">Login</a>
  </p>
</form>

  </div>
</div>

<footer>
  © 2025 Patholytica by MedicineBank. All rights reserved.
  <br>
  <a href="#">Privacy Policy</a> | 
  <a href="#">Terms</a> | 
  <a href="#">Contact</a>
</footer>

<script type="module">
import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js';
import { 
  getAuth, 
  signInWithEmailAndPassword, 
  createUserWithEmailAndPassword, 
  GoogleAuthProvider, 
  signInWithPopup,
  signInWithRedirect,
  getRedirectResult
} from 'https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js';

const firebaseConfig = {
  apiKey: "AIzaSyBs6V0yY14cuLBXB1nciZ-X0eyAiodC-Ak",
  authDomain: "patholytica.firebaseapp.com",
  projectId: "patholytica",
  storageBucket: "patholytica.firebasestorage.app",
  messagingSenderId: "738430635282",
  appId: "1:738430635282:web:8451ef380447c7611137cb"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);

let isProcessingRedirect = false;

// NOTIFICATION SYSTEM
function showNotification(message, type = 'info') {
  const notificationArea = document.getElementById('notificationArea');
  const notification = document.createElement('div');
  notification.className = `notification ${type}`;
  
  notification.innerHTML = `
    <div class="notification-dot"></div>
    <span class="notification-message">${message}</span>
  `;
  
  notificationArea.appendChild(notification);
  
  setTimeout(() => {
    notification.classList.add('show');
  }, 10);
  
  setTimeout(() => {
    notification.classList.remove('show');
    setTimeout(() => {
      if (notification.parentNode) {
        notification.parentNode.removeChild(notification);
      }
    }, 400);
  }, 5000);
}

// THEME
function toggleTheme(){
  document.body.classList.toggle('light-theme');
  localStorage.setItem(
    "theme",
    document.body.classList.contains("light-theme") ? "light" : "dark"
  );
}

if (localStorage.getItem("theme") === "light") {
  document.body.classList.add("light-theme");
}

window.toggleTheme = toggleTheme;

// UI elements
const initialButtons = document.getElementById("initialButtons");
const startBtn = document.getElementById("startLoginBtn");
const form = document.getElementById("loginForm");
const signupForm = document.getElementById("signupForm");
const showSignupLink = document.getElementById("showSignupLink");
const showLoginLink = document.getElementById("showLoginLink");
const guestBtn = document.getElementById("guestBtn");
const backToInitial = document.getElementById("backToInitial");

// Show login form
startBtn.addEventListener("click", () => {
  initialButtons.style.opacity = "0";
  setTimeout(() => {
    initialButtons.style.display = "none";
    form.style.display = "block";
    form.style.opacity = "1";
  }, 250);
});

// Back to initial
backToInitial.addEventListener("click", (e) => {
  e.preventDefault();
  form.style.opacity = "0";
  setTimeout(() => {
    form.style.display = "none";
    initialButtons.style.display = "block";
    initialButtons.style.opacity = "1";
  }, 250);
});

// Guest mode - redirects to libraries page
guestBtn.addEventListener("click", () => {
  showNotification("Entering Guest Mode. Redirecting...", "info");
  setTimeout(() => {
    window.location.href = "https://patholytica.com/home";
  }, 1000);
});

// Switch to signup
showSignupLink.addEventListener("click", (e) => {
  e.preventDefault();
  form.style.opacity = "0";
  setTimeout(() => {
    form.style.display = "none";
    signupForm.style.display = "block";
    signupForm.style.opacity = "1";
  }, 250);
});

// Back to login
showLoginLink.addEventListener("click", (e) => {
  e.preventDefault();
  signupForm.style.opacity = "0";
  setTimeout(() => {
    signupForm.style.display = "none";
    form.style.display = "block";
    form.style.opacity = "1";
  }, 250);
});

// LOGIN - redirects to libraries page
form.addEventListener("submit", (e) => {
  e.preventDefault();
  const email = document.getElementById('loginEmail').value.trim();
  const password = document.getElementById('loginPassword').value;
  const loginSpinner = document.getElementById('loginSpinner');
  const submitBtn = document.getElementById('loginSubmitBtn');

  loginSpinner.classList.add('show');
  submitBtn.disabled = true;

  signInWithEmailAndPassword(auth, email, password)
    .then(() => {
      showNotification("Login successful! Redirecting...", "success");
      setTimeout(() => {
        window.location.href = "https://patholytica.com/home";
      }, 1000);
    })
    .catch(err => {
      console.error("Login error:", err);
      let errorMessage = "Login failed. ";
      
      switch (err.code) {
        case 'auth/invalid-email':
          errorMessage += "Invalid email address.";
          break;
        case 'auth/user-disabled':
          errorMessage += "This account has been disabled.";
          break;
        case 'auth/user-not-found':
          errorMessage += "No account found with this email.";
          break;
        case 'auth/wrong-password':
        case 'auth/invalid-credential':
          errorMessage += "Incorrect email or password.";
          break;
        case 'auth/too-many-requests':
          errorMessage += "Too many attempts. Try again later.";
          break;
        default:
          errorMessage += err.message;
      }
      
      showNotification(errorMessage, "error");
    })
    .finally(() => {
      loginSpinner.classList.remove('show');
      submitBtn.disabled = false;
    });
});

// SIGNUP - redirects to libraries page
signupForm.addEventListener("submit", (e) => {
  e.preventDefault();
  const name = document.getElementById('signupName').value.trim();
  const email = document.getElementById('signupEmail').value.trim();
  const username = document.getElementById('signupUsername').value.trim();
  const password = document.getElementById('signupPassword').value;
  const confirmPassword = document.getElementById('signupConfirm').value;
  const termsChecked = document.getElementById('termsCheckbox').checked;
  const signupSpinner = document.getElementById('signupSpinner');
  const submitBtn = document.getElementById('signupSubmitBtn');

  if (!termsChecked) {
    showNotification("Please agree to the Terms and Privacy Policy", "warning");
    return;
  }

  if (password !== confirmPassword) {
    showNotification("Passwords do not match.", "error");
    return;
  }

  if (password.length < 8) {
    showNotification("Password must be at least 8 characters.", "error");
    return;
  }

  signupSpinner.classList.add('show');
  submitBtn.disabled = true;

  createUserWithEmailAndPassword(auth, email, password)
    .then(() => {
      showNotification("Account created successfully! Redirecting...", "success");
      setTimeout(() => {
        window.location.href = "https://patholytica.com/home";
      }, 1000);
    })
    .catch(err => {
      console.error("Signup error:", err);
      let errorMessage = "Signup failed. ";
      
      switch (err.code) {
        case 'auth/email-already-in-use':
          errorMessage += "Email is already registered.";
          break;
        case 'auth/invalid-email':
          errorMessage += "Invalid email address.";
          break;
        case 'auth/weak-password':
          errorMessage += "Password is too weak.";
          break;
        default:
          errorMessage += err.message;
      }
      
      showNotification(errorMessage, "error");
    })
    .finally(() => {
      signupSpinner.classList.remove('show');
      submitBtn.disabled = false;
    });
});

// GOOGLE SIGN-IN with iOS/Mobile detection - redirects to libraries page
const provider = new GoogleAuthProvider();
const googleBtn = document.getElementById("googleLoginBtn");
const googleSpinner = document.getElementById("googleSpinner");

const isMobile = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent);
const isIOS = /iPhone|iPad|iPod/i.test(navigator.userAgent);

// Check for redirect result on page load (for iOS)
(async function checkRedirectResult() {
  if (isProcessingRedirect) return;
  isProcessingRedirect = true;
  
  try {
    const result = await getRedirectResult(auth);
    if (result && result.user) {
      console.log("Google User signed in via redirect:", result.user.email);
      showNotification("Welcome to Patholytica!", "success");
      setTimeout(() => {
        window.location.href = "https://patholytica.com/home";
      }, 1000);
    }
  } catch (error) {
    console.error("Redirect sign-in error:", error);
    if (error.code && error.code !== 'auth/cancelled-popup-request') {
      let errorMessage = 'Sign-in failed. ';
      switch (error.code) {
        case 'auth/account-exists-with-different-credential':
          errorMessage += 'Account exists with different sign-in method.';
          break;
        case 'auth/popup-blocked':
          errorMessage += 'Popup was blocked by browser.';
          break;
        default:
          errorMessage += error.message;
      }
      showNotification(errorMessage, "error");
    }
  } finally {
    isProcessingRedirect = false;
  }
})();

googleBtn.addEventListener("click", async () => {
  if (googleBtn.disabled) return;
  
  googleBtn.disabled = true;
  googleSpinner.classList.add('show');
  
  try {
    // Use redirect for iOS (more reliable than popup)
    if (isIOS) {
      await signInWithRedirect(auth, provider);
      // Page will reload, no need to hide spinner
    } else {
      // Use popup for desktop and Android
      const result = await signInWithPopup(auth, provider);
      console.log("Google User signed in:", result.user.email);
      showNotification("Welcome to Patholytica!", "success");
      setTimeout(() => {
        window.location.href = "https://patholytica.com/home";
      }, 1000);
    }
  } catch (error) {
    console.error("Google sign-in error:", error);
    
    let errorMessage = null;
    if (error.code === 'auth/popup-closed-by-user') {
      errorMessage = 'Sign-in cancelled. Please try again.';
    } else if (error.code === 'auth/popup-blocked') {
      errorMessage = 'Popup blocked. Please allow popups for this site.';
    } else if (error.code === 'auth/cancelled-popup-request') {
      // Silent fail - multiple clicks
      errorMessage = null;
    } else if (error.code === 'auth/account-exists-with-different-credential') {
      errorMessage = 'Account exists with different sign-in method.';
    } else {
      errorMessage = 'Google sign-in failed: ' + error.message;
    }
    
    if (errorMessage) {
      showNotification(errorMessage, "error");
    }
  } finally {
    if (!isIOS) {
      googleBtn.disabled = false;
      googleSpinner.classList.remove('show');
    }
  }
});

// Welcome message on load
window.addEventListener('load', () => {
  setTimeout(() => {
    showNotification("Welcome to Patholytica! Start your journey.", "info");
  }, 800);
});
</script>

</body>
</html>