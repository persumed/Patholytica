<!DOCTYPE html>

<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
<title>Patholytica â€” Messaging</title>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

<style>
:root {
  --bg-color: #0d0d0d;
  --text-color: #fff;
  --card-bg: rgba(24,24,24,0.7);
  --card-border: rgba(255,255,255,0.07);
  --accent: #b0003a;
  --accent-hover: #88002a;
  --success: #10b981;
  --error: #ef4444;
  --warning: #f59e0b;
  --info: #3b82f6;
  --chat-bg: #111;
  --message-sent: #b0003a;
  --message-received: rgba(40,40,40,0.9);
  --input-bg: rgba(30,30,30,0.8);
}

body.light-theme {
  --bg-color: #f5f5f5;
  --text-color: #111;
  --card-bg: rgba(255,255,255,0.65);
  --card-border: rgba(0,0,0,0.1);
  --accent: #b0003a;
  --accent-hover: #88002a;
  --chat-bg: #e5ddd5;
  --message-sent: #dcf8c6;
  --message-received: #fff;
  --input-bg: rgba(255,255,255,0.95);
}

* { box-sizing: border-box; margin: 0; padding: 0; }
html, body { height: 100%; font-family: "Inter", Arial, sans-serif; }

body {
  background: var(--bg-color);
  color: var(--text-color);
  display: flex;
  flex-direction: column;
  transition: background 0.35s ease;
}

.header-wrapper {
  position: sticky;
  top: 0;
  background: var(--bg-color);
  padding-top: env(safe-area-inset-top);
  border-bottom: 1px solid var(--card-border);
  z-index: 40;
}

.header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 16px 18px;
}

.logo-img {
  height: 32px;
  width: auto;
  transition: filter 0.25s ease;
  cursor: pointer;
}

body.light-theme .logo-img {
  filter: invert(1);
}

.theme-toggle {
  padding: 6px 14px;
  font-size: 12.5px;
  background: transparent;
  border-radius: 6px;
  border: 1px solid var(--card-border);
  color: var(--text-color);
  cursor: pointer;
  transition: 0.25s ease;
}
.theme-toggle:hover {
  border-color: var(--accent);
  color: var(--accent);
}

.chat-container {
  flex: 1;
  display: flex;
  overflow: hidden;
}

/* Sidebar */
.sidebar {
  width: 350px;
  background: var(--card-bg);
  backdrop-filter: blur(22px);
  border-right: 1px solid var(--card-border);
  display: flex;
  flex-direction: column;
  transition: transform 0.3s ease;
}

.sidebar-header {
  padding: 20px;
  border-bottom: 1px solid var(--card-border);
  display: flex;
  align-items: center;
  gap: 12px;
  margin-bottom: 12px;
}

.sidebar-logo {
  height: 32px;
  width: auto;
  transition: filter 0.25s ease;
  cursor: pointer;
}

body.light-theme .sidebar-logo {
  filter: invert(1);
}

.search-box {
  width: 100%;
  padding: 10px 14px;
  border-radius: 8px;
  border: 1px solid var(--card-border);
  background: var(--input-bg);
  color: var(--text-color);
  font-size: 14px;
  transition: 0.25s ease;
}

.search-box:focus {
  border-color: var(--accent);
  outline: none;
}

.chat-list {
  flex: 1;
  overflow-y: auto;
}

.chat-item {
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 16px 20px;
  cursor: pointer;
  transition: background 0.2s ease;
  border-bottom: 1px solid var(--card-border);
}

.chat-item:hover {
  background: rgba(255,255,255,0.05);
}

body.light-theme .chat-item:hover {
  background: rgba(0,0,0,0.03);
}

.chat-item.active {
  background: rgba(176,0,58,0.15);
}

.chat-avatar {
  width: 48px;
  height: 48px;
  border-radius: 50%;
  background: linear-gradient(135deg, var(--accent), var(--accent-hover));
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 20px;
  font-weight: 600;
  color: white;
  flex-shrink: 0;
}

.chat-info {
  flex: 1;
  min-width: 0;
}

.chat-name {
  font-weight: 600;
  font-size: 15px;
  margin-bottom: 4px;
}

.chat-preview {
  font-size: 13px;
  color: #999;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

.chat-meta {
  display: flex;
  flex-direction: column;
  align-items: flex-end;
  gap: 4px;
}

.chat-time {
  font-size: 12px;
  color: #888;
}

.chat-badge {
  background: var(--accent);
  color: white;
  border-radius: 10px;
  padding: 2px 8px;
  font-size: 11px;
  font-weight: 600;
}

/* Main Chat Area */
.chat-main {
  flex: 1;
  display: flex;
  flex-direction: column;
  background: var(--chat-bg);
}

.chat-header {
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 16px 20px;
  background: var(--card-bg);
  backdrop-filter: blur(22px);
  border-bottom: 1px solid var(--card-border);
}

.menu-toggle {
  display: none;
  background: none;
  border: none;
  color: var(--text-color);
  font-size: 20px;
  cursor: pointer;
  padding: 8px;
}

.chat-header-info {
  flex: 1;
}

.chat-header-name {
  font-size: 16px;
  font-weight: 600;
}

.chat-header-status {
  font-size: 13px;
  color: #999;
  margin-top: 2px;
}

.chat-actions {
  display: flex;
  gap: 12px;
}

.action-btn {
  background: none;
  border: none;
  color: var(--text-color);
  font-size: 18px;
  cursor: pointer;
  padding: 8px;
  transition: color 0.2s ease;
}

.action-btn:hover {
  color: var(--accent);
}

/* Messages */
.messages-container {
  flex: 1;
  overflow-y: auto;
  padding: 20px;
  display: flex;
  flex-direction: column;
  gap: 12px;
}

.message {
  display: flex;
  gap: 8px;
  max-width: 70%;
  animation: fadeIn 0.3s ease;
}

.message.sent {
  align-self: flex-end;
  flex-direction: row-reverse;
}

.message.received {
  align-self: flex-start;
}

.message-bubble {
  background: var(--message-received);
  padding: 10px 14px;
  border-radius: 12px;
  box-shadow: 0 2px 8px rgba(0,0,0,0.1);
  position: relative;
}

.message.sent .message-bubble {
  background: var(--message-sent);
  color: white;
}

body.light-theme .message.sent .message-bubble {
  color: #111;
}

.message-text {
  font-size: 14px;
  line-height: 1.5;
  word-wrap: break-word;
}

.message-time {
  font-size: 11px;
  color: rgba(255,255,255,0.6);
  margin-top: 4px;
  text-align: right;
}

body.light-theme .message-time {
  color: rgba(0,0,0,0.5);
}

.message.sent .message-time {
  color: rgba(255,255,255,0.7);
}

body.light-theme .message.sent .message-time {
  color: rgba(0,0,0,0.6);
}

/* Input Area */
.input-area {
  padding: 16px 20px;
  background: var(--card-bg);
  backdrop-filter: blur(22px);
  border-top: 1px solid var(--card-border);
  display: flex;
  gap: 12px;
  align-items: center;
}

.attach-btn {
  background: none;
  border: none;
  color: var(--text-color);
  font-size: 20px;
  cursor: pointer;
  padding: 8px;
  transition: color 0.2s ease;
}

.attach-btn:hover {
  color: var(--accent);
}

.message-input {
  flex: 1;
  padding: 12px 16px;
  border-radius: 24px;
  border: 1px solid var(--card-border);
  background: var(--input-bg);
  color: var(--text-color);
  font-size: 14px;
  font-family: inherit;
  resize: none;
  max-height: 120px;
  transition: 0.25s ease;
}

.message-input:focus {
  border-color: var(--accent);
  outline: none;
}

.send-btn {
  width: 44px;
  height: 44px;
  border-radius: 50%;
  border: none;
  background: var(--accent);
  color: white;
  font-size: 18px;
  cursor: pointer;
  transition: 0.25s ease;
  display: flex;
  align-items: center;
  justify-content: center;
}

.send-btn:hover {
  background: var(--accent-hover);
  transform: scale(1.05);
}

.send-btn:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: scale(1);
}

/* Empty State */
.empty-state {
  flex: 1;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding: 40px;
  text-align: center;
  color: #999;
}

.empty-state i {
  font-size: 64px;
  margin-bottom: 20px;
  opacity: 0.3;
}

.empty-state h3 {
  font-size: 20px;
  margin-bottom: 8px;
  color: var(--text-color);
}

.empty-state p {
  font-size: 14px;
}

@keyframes fadeIn {
  from { opacity: 0; transform: translateY(10px); }
  to { opacity: 1; transform: translateY(0); }
}

@keyframes pulse {
  0%, 100% { opacity: 0.3; }
  50% { opacity: 1; }
}

/* Scrollbar */
::-webkit-scrollbar {
  width: 6px;
}

::-webkit-scrollbar-track {
  background: transparent;
}

::-webkit-scrollbar-thumb {
  background: rgba(255,255,255,0.1);
  border-radius: 3px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255,255,255,0.2);
}

body.light-theme ::-webkit-scrollbar-thumb {
  background: rgba(0,0,0,0.1);
}

body.light-theme ::-webkit-scrollbar-thumb:hover {
  background: rgba(0,0,0,0.2);
}

/* Responsive */
@media (max-width: 768px) {
  .sidebar {
    position: absolute;
    left: 0;
    top: 0;
    bottom: 0;
    z-index: 50;
    transform: translateX(-100%);
    width: 85%;
    max-width: 350px;
  }
  
  .sidebar.open {
    transform: translateX(0);
  }
  
  .menu-toggle {
    display: block;
  }
  
  .message {
    max-width: 85%;
  }
  
  .sidebar-overlay {
    display: none;
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.5);
    z-index: 45;
  }
  
  .sidebar-overlay.show {
    display: block;
  }
}
</style>

</head>
<body>

<div class="chat-container">
  <!-- Sidebar -->
  <div class="sidebar" id="sidebar">
    <div class="sidebar-header">
      <a href="https://patholytica.com">
        <img src="IMG_0696.png" class="sidebar-logo" alt="Patholytica Logo">
      </a>
      <button class="theme-toggle" onclick="toggleTheme()">Theme</button>
    </div>

<div style="padding: 0 20px 16px 20px;">
  <input type="text" class="search-box" placeholder="Search conversations..." id="searchBox">
</div>

<div class="chat-list" id="chatList">
  <div class="chat-item active" data-chat="1">
    <div class="chat-avatar">AI</div>
    <div class="chat-info">
      <div class="chat-name">AI Assistant</div>
      <div class="chat-preview">How can I help you today?</div>
    </div>
    <div class="chat-meta">
      <div class="chat-time">12:30</div>
      <div class="chat-badge">2</div>
    </div>
  </div>
  
  <div class="chat-item" data-chat="2">
    <div class="chat-avatar">DR</div>
    <div class="chat-info">
      <div class="chat-name">Dr. Smith</div>
      <div class="chat-preview">Lab results are ready</div>
    </div>
    <div class="chat-meta">
      <div class="chat-time">11:45</div>
    </div>
  </div>
  
  <div class="chat-item" data-chat="3">
    <div class="chat-avatar">SU</div>
    <div class="chat-info">
      <div class="chat-name">Support Team</div>
      <div class="chat-preview">Thank you for reaching out</div>
    </div>
    <div class="chat-meta">
      <div class="chat-time">Yesterday</div>
    </div>
  </div>
</div>

  </div>

  <div class="sidebar-overlay" id="sidebarOverlay"></div>

  <!-- Main Chat -->

  <div class="chat-main">
    <div class="chat-header">
      <button class="menu-toggle" id="menuToggle">
        <i class="fas fa-bars"></i>
      </button>
      <div class="chat-avatar">AI</div>
      <div class="chat-header-info">
        <div class="chat-header-name">AI Assistant</div>
        <div class="chat-header-status">Online</div>
      </div>
      <div class="chat-actions">
        <button class="action-btn"><i class="fas fa-phone"></i></button>
        <button class="action-btn"><i class="fas fa-video"></i></button>
        <button class="action-btn"><i class="fas fa-ellipsis-v"></i></button>
      </div>
    </div>

<div class="messages-container" id="messagesContainer">
  <div class="message received">
    <div class="message-bubble">
      <div class="message-text">Hello! Welcome to Patholytica. How can I assist you today?</div>
      <div class="message-time">12:28</div>
    </div>
  </div>
  
  <div class="message sent">
    <div class="message-bubble">
      <div class="message-text">Hi! I need help understanding my test results.</div>
      <div class="message-time">12:29</div>
    </div>
  </div>
  
  <div class="message received">
    <div class="message-bubble">
      <div class="message-text">I'd be happy to help you with that. Could you please share which specific test results you'd like me to explain?</div>
      <div class="message-time">12:30</div>
    </div>
  </div>
</div>

<div class="input-area">
  <button class="attach-btn">
    <i class="fas fa-paperclip"></i>
  </button>
  <textarea 
    class="message-input" 
    id="messageInput" 
    placeholder="Type a message..." 
    rows="1"
  ></textarea>
  <button class="send-btn" id="sendBtn">
    <i class="fas fa-paper-plane"></i>
  </button>
</div>

  </div>
</div>

<script>
function toggleTheme(){
  document.body.classList.toggle('light-theme');
  localStorage.setItem(
    "theme",
    document.body.classList.contains("light-theme") ? "light" : "dark"
  );
}

if (localStorage.getItem("theme") === "light") {
  document.body.classList.add("light-theme");
}

// Mobile menu toggle
const menuToggle = document.getElementById('menuToggle');
const sidebar = document.getElementById('sidebar');
const sidebarOverlay = document.getElementById('sidebarOverlay');

menuToggle.addEventListener('click', () => {
  sidebar.classList.toggle('open');
  sidebarOverlay.classList.toggle('show');
});

sidebarOverlay.addEventListener('click', () => {
  sidebar.classList.remove('open');
  sidebarOverlay.classList.remove('show');
});

// Chat selection
const chatItems = document.querySelectorAll('.chat-item');
chatItems.forEach(item => {
  item.addEventListener('click', () => {
    chatItems.forEach(i => i.classList.remove('active'));
    item.classList.add('active');
    
    // Close sidebar on mobile
    if (window.innerWidth <= 768) {
      sidebar.classList.remove('open');
      sidebarOverlay.classList.remove('show');
    }
  });
});

// Message sending
const messageInput = document.getElementById('messageInput');
const sendBtn = document.getElementById('sendBtn');
const messagesContainer = document.getElementById('messagesContainer');

function getCurrentTime() {
  const now = new Date();
  return now.getHours().toString().padStart(2, '0') + ':' + 
         now.getMinutes().toString().padStart(2, '0');
}

// Store conversation history
let conversationHistory = [
  {
    role: "user",
    content: "Hello! Welcome to Patholytica. How can I assist you today?"
  },
  {
    role: "assistant", 
    content: "Hello! Welcome to Patholytica. How can I assist you today?"
  },
  {
    role: "user",
    content: "Hi! I need help understanding my test results."
  },
  {
    role: "assistant",
    content: "Hi! I need help understanding my test results."
  }
];

async function getAIResponse(userMessage) {
  try {
    // Show typing indicator
    const typingDiv = document.createElement('div');
    typingDiv.className = 'message received typing-indicator';
    typingDiv.id = 'typingIndicator';
    typingDiv.innerHTML = `
      <div class="message-bubble">
        <div class="message-text">
          <i class="fas fa-circle" style="font-size: 8px; opacity: 0.5; animation: pulse 1.5s ease-in-out infinite;"></i>
          <i class="fas fa-circle" style="font-size: 8px; opacity: 0.5; animation: pulse 1.5s ease-in-out 0.2s infinite;"></i>
          <i class="fas fa-circle" style="font-size: 8px; opacity: 0.5; animation: pulse 1.5s ease-in-out 0.4s infinite;"></i>
        </div>
      </div>
    `;
    messagesContainer.appendChild(typingDiv);
    messagesContainer.scrollTop = messagesContainer.scrollHeight;

    // Add user message to history
    conversationHistory.push({
      role: "user",
      content: userMessage
    });

    const response = await fetch("https://api.anthropic.com/v1/messages", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
      },
      body: JSON.stringify({
        model: "claude-sonnet-4-20250514",
        max_tokens: 1000,
        system: "You are a helpful medical AI assistant for Patholytica, a healthcare platform. Provide clear, concise, and empathetic responses. Keep answers professional but friendly. If discussing medical topics, remind users to consult healthcare professionals for diagnosis and treatment.",
        messages: conversationHistory.slice(-10) // Keep last 10 messages for context
      })
    });

    const data = await response.json();
    
    // Remove typing indicator
    const typing = document.getElementById('typingIndicator');
    if (typing) typing.remove();

    if (data.content && data.content[0]) {
      const aiMessage = data.content[0].text;
      
      // Add AI response to history
      conversationHistory.push({
        role: "assistant",
        content: aiMessage
      });

      return aiMessage;
    } else {
      throw new Error("Invalid response from AI");
    }
  } catch (error) {
    console.error("AI Error:", error);
    
    // Remove typing indicator
    const typing = document.getElementById('typingIndicator');
    if (typing) typing.remove();
    
    return "I apologize, but I'm having trouble responding right now. Please try again in a moment.";
  }
}

async function sendMessage() {
  const text = messageInput.value.trim();
  if (!text) return;
  
  // Disable input while processing
  messageInput.disabled = true;
  sendBtn.disabled = true;
  
  const messageDiv = document.createElement('div');
  messageDiv.className = 'message sent';
  messageDiv.innerHTML = `
    <div class="message-bubble">
      <div class="message-text">${text.replace(/</g, '&lt;').replace(/>/g, '&gt;')}</div>
      <div class="message-time">${getCurrentTime()}</div>
    </div>
  `;
  
  messagesContainer.appendChild(messageDiv);
  messageInput.value = '';
  messageInput.style.height = 'auto';
  messagesContainer.scrollTop = messagesContainer.scrollHeight;
  
  // Get AI response
  const aiResponse = await getAIResponse(text);
  
  const responseDiv = document.createElement('div');
  responseDiv.className = 'message received';
  responseDiv.innerHTML = `
    <div class="message-bubble">
      <div class="message-text">${aiResponse.replace(/</g, '&lt;').replace(/>/g, '&gt;')}</div>
      <div class="message-time">${getCurrentTime()}</div>
    </div>
  `;
  messagesContainer.appendChild(responseDiv);
  messagesContainer.scrollTop = messagesContainer.scrollHeight;
  
  // Re-enable input
  messageInput.disabled = false;
  sendBtn.disabled = false;
  messageInput.focus();
}

sendBtn.addEventListener('click', sendMessage);

messageInput.addEventListener('keypress', (e) => {
  if (e.key === 'Enter' && !e.shiftKey) {
    e.preventDefault();
    sendMessage();
  }
});

// Auto-resize textarea
messageInput.addEventListener('input', function() {
  this.style.height = 'auto';
  this.style.height = Math.min(this.scrollHeight, 120) + 'px';
});

// Search functionality
const searchBox = document.getElementById('searchBox');
searchBox.addEventListener('input', (e) => {
  const searchTerm = e.target.value.toLowerCase();
  chatItems.forEach(item => {
    const name = item.querySelector('.chat-name').textContent.toLowerCase();
    const preview = item.querySelector('.chat-preview').textContent.toLowerCase();
    if (name.includes(searchTerm) || preview.includes(searchTerm)) {
      item.style.display = 'flex';
    } else {
      item.style.display = 'none';
    }
  });
});
</script>

</body>
</html>