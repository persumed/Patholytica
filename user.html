<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Users Viewer</title>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<style>
body { font-family: Arial; padding: 20px; background: #111; color: #fff; }
table { border-collapse: collapse; width: 100%; margin-top: 20px; }
th, td { border: 1px solid #555; padding: 8px; text-align: left; }
th { background: #333; }
tr:nth-child(even) { background: #222; }
.error { color: red; margin-top: 20px; }
</style>
</head>
<body>

<h1>Users Tableo</h1>
<div id="errorContainer" class="error"></div>
<table id="usersTable">
  <thead>
    <tr>
      <th>UserID</th>
      <th>Username</th>
      <th>Email</th>
      <th>Bronze</th>
      <th>Gold</th>
      <th>Platinum</th>
      <th>CreatedAt</th>
    </tr>
  </thead>
  <tbody>
    <tr><td colspan="7">Loading...</td></tr>
  </tbody>
</table>

<script>
const SUPABASE_URL = 'https://aforyattbmwcafvtgnry.supabase.co';
const SUPABASE_KEY = 'sb_publishable_p16iKxaLD9u2tdWAYhitpg_-X4rvsts';

const supabase = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

async function loadUsers() {
  const tbody = document.querySelector('#usersTable tbody');
  const errorDiv = document.getElementById('errorContainer');
  errorDiv.textContent = '';

  try {
    const { data, error } = await supabase
      .from('users') // lowercase table name
      .select('*')
      .order('userid', { ascending: true });

    if (error) throw error;

    if (!data || data.length === 0) {
      tbody.innerHTML = `<tr><td colspan="7">No users found.</td></tr>`;
      return;
    }

    tbody.innerHTML = data.map(user => `
      <tr>
        <td>${user.userid}</td>
        <td>${user.username}</td>
        <td>${user.email}</td>
        <td>${user.bronze ?? 0}</td>
        <td>${user.gold ?? 0}</td>
        <td>${user.platinum ?? 0}</td>
        <td>${user.createdat ? new Date(user.createdat).toLocaleString() : ''}</td>
      </tr>
    `).join('');

  } catch (err) {
    tbody.innerHTML = `<tr><td colspan="7">Failed to load users.</td></tr>`;
    errorDiv.textContent = `Error fetching users: ${err.message}`;
    console.error(err);
  }
}

loadUsers();
</script>

</body>
</html>